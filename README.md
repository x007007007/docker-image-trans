# Dockeré•œåƒè½¬æ¢å·¥å…·

ä¸€ä¸ªåŸºäºFastAPIå’ŒWebSocketçš„Dockeré•œåƒè½¬æ¢å·¥å…·ï¼Œå¯ä»¥æ‹‰å–Dockeré•œåƒï¼Œé‡æ ‡ç­¾å¹¶æ¨é€åˆ°æ–°çš„é•œåƒä»“åº“ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ³ æ”¯æŒå¤šç§Dockeré•œåƒæ ¼å¼
- ğŸ“¡ å®æ—¶WebSocketè¿›åº¦æ›´æ–°
- ğŸ¨ ç°ä»£åŒ–ç¾è§‚çš„Webç•Œé¢
- âš¡ å®Œå…¨å¼‚æ­¥æ¶æ„ï¼Œä¸é˜»å¡äº‹ä»¶å¾ªç¯
- ğŸ”„ è‡ªåŠ¨é‡è¿WebSocketè¿æ¥
- ğŸ“± å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨è®¾å¤‡
- ğŸ›¡ï¸ ä½¿ç”¨å®˜æ–¹Docker Python SDKï¼Œæ›´å®‰å…¨å¯é 
- ğŸ“Š è¯¦ç»†çš„é”™è¯¯å¤„ç†å’ŒçŠ¶æ€åé¦ˆ
- ğŸ”’ å®‰å…¨çš„Dockerå®¢æˆ·ç«¯ç®¡ç†ï¼Œæ¯æ¬¡æ“ä½œåè‡ªåŠ¨å…³é—­è¿æ¥
- ğŸ§µ çº¿ç¨‹æ± æ‰§è¡ŒDockeræ“ä½œï¼Œé¿å…é˜»å¡å¼‚æ­¥äº‹ä»¶å¾ªç¯
- ğŸ” å®æ—¶DockerçŠ¶æ€ç›‘æ§ï¼Œç›´æ¥åœ¨Webç•Œé¢æ˜¾ç¤º

## æ”¯æŒçš„é•œåƒæ ¼å¼

### åŸºæœ¬æ ¼å¼
- `nginx:latest` â†’ `localhost:5000/library/nginx:latest`
- `ubuntu:20.04` â†’ `localhost:5000/library/ubuntu:20.04`

### å¸¦Registryæ ¼å¼
- `docker.io/nginx:1.21` â†’ `localhost:5000/library/nginx:1.21`
- `gcr.io/google-samples/hello-app:1.0` â†’ `localhost:5000/google-samples/hello-app:1.0`

### å®Œæ•´æ ¼å¼
- `quay.io/prometheus/prometheus:v2.40.0` â†’ `localhost:5000/prometheus/prometheus:v2.40.0`
- `my-registry.com/my-project/app:v1.0` â†’ `localhost:5000/my-project/app:v1.0`

### è½¬æ¢è§„åˆ™
1. **ç®€å•åç§°** (`name:tag`) â†’ è‡ªåŠ¨æ·»åŠ  `library/` å‰ç¼€
2. **Docker Hub** (`docker.io/library/name:tag`) â†’ çœç•¥ `docker.io` å‰ç¼€
3. **å…¶ä»–Registry** â†’ ä¿ç•™å®Œæ•´è·¯å¾„ç»“æ„
4. **ç›®æ ‡é•œåƒ** â†’ ç»Ÿä¸€ä½¿ç”¨ `æ–°åŸŸå/bucket/name:tag` æ ¼å¼

## ç¯å¢ƒè¦æ±‚

- Python 3.8+
- Docker CLI
- uvåŒ…ç®¡ç†å™¨

## å®‰è£…å’Œè¿è¡Œ

### 1. å®‰è£…ä¾èµ–

```bash
# ä½¿ç”¨uvå®‰è£…ä¾èµ–
uv sync
```

### 2. è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰

```bash
# è®¾ç½®æ–°çš„é•œåƒä»“åº“åŸŸå
export NEW_DOMAIN="your-registry.com:5000"

# å¦‚æœä¸è®¾ç½®ï¼Œé»˜è®¤ä½¿ç”¨ localhost:5000
```

### 3. è¿è¡Œåº”ç”¨

```bash
# ä½¿ç”¨å¯åŠ¨è„šæœ¬
uv run python src/start.py

# æˆ–è€…ä½¿ç”¨uvicornç›´æ¥è¿è¡Œ
uv run uvicorn src.main:app --host 0.0.0.0 --port 8000 --reload
```

### 4. è®¿é—®åº”ç”¨

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:8000

## ä½¿ç”¨æ–¹æ³•

1. åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥è¦è½¬æ¢çš„Dockeré•œåƒåç§°
2. ç‚¹å‡»"å¼€å§‹è½¬æ¢"æŒ‰é’®
3. ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
   - æ‹‰å–æŒ‡å®šçš„Dockeré•œåƒ
   - é‡æ ‡ç­¾ä¸ºæ–°çš„åŸŸå
   - æ¨é€åˆ°æ–°çš„é•œåƒä»“åº“
4. å®æ—¶æŸ¥çœ‹å¤„ç†è¿›åº¦å’ŒçŠ¶æ€ä¿¡æ¯

## é¡¹ç›®ç»“æ„

```
image_trans/
â”œâ”€â”€ src/                       # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ main.py               # FastAPIä¸»åº”ç”¨
â”‚   â”œâ”€â”€ docker_manager.py     # Dockerç®¡ç†å™¨ï¼ˆæ”¯æŒå¼‚æ­¥ï¼‰
â”‚   â”œâ”€â”€ start.py              # å¯åŠ¨è„šæœ¬
â”‚   â””â”€â”€ static/               # é™æ€æ–‡ä»¶
â”‚       â””â”€â”€ index.html        # å‰ç«¯é¡µé¢
â”œâ”€â”€ test/                     # æµ‹è¯•ä»£ç ç›®å½•
â”‚   â”œâ”€â”€ test_docker_sdk.py    # Docker SDKæµ‹è¯•è„šæœ¬
â”‚   â””â”€â”€ performance_test.py   # æ€§èƒ½æµ‹è¯•è„šæœ¬
â”œâ”€â”€ pyproject.toml            # é¡¹ç›®é…ç½®
â””â”€â”€ README.md                 # é¡¹ç›®è¯´æ˜
```

## APIæ¥å£

### WebSocketæ¥å£

- **è¿æ¥åœ°å€**: `/ws`
- **åŠŸèƒ½**: å®æ—¶è¿›åº¦æ›´æ–°

### HTTPæ¥å£

- **GET** `/health`
  - å“åº”: `{"status": "ok", "docker": "healthy|unhealthy", "timestamp": æ—¶é—´æˆ³}`
  - åŠŸèƒ½: å¥åº·æ£€æŸ¥ï¼ŒéªŒè¯Dockerè¿æ¥çŠ¶æ€

- **POST** `/process-image`
  - è¯·æ±‚ä½“: `{"image_name": "é•œåƒåç§°"}`
  - å“åº”: `{"message": "å¤„ç†çŠ¶æ€", "image_name": "é•œåƒåç§°"}`

## æ³¨æ„äº‹é¡¹

1. ç¡®ä¿DockeræœåŠ¡æ­£åœ¨è¿è¡Œ
2. ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´å­˜å‚¨é•œåƒ
3. ç¡®ä¿æœ‰æƒé™æ¨é€åˆ°ç›®æ ‡é•œåƒä»“åº“
4. ç½‘ç»œè¿æ¥ç¨³å®šï¼Œé¿å…é•œåƒæ‹‰å–å¤±è´¥

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **Dockerå‘½ä»¤æ‰§è¡Œå¤±è´¥**
   - æ£€æŸ¥DockeræœåŠ¡æ˜¯å¦è¿è¡Œ
   - æ£€æŸ¥Docker CLIæƒé™

2. **WebSocketè¿æ¥å¤±è´¥**
   - æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
   - æ£€æŸ¥ç½‘ç»œè¿æ¥

3. **é•œåƒæ¨é€å¤±è´¥**
   - æ£€æŸ¥ç›®æ ‡ä»“åº“æƒé™
   - æ£€æŸ¥ç½‘ç»œè¿æ¥

## å¼€å‘

### å®‰è£…å¼€å‘ä¾èµ–

```bash
uv sync --dev
```

### ä»£ç æ ¼å¼åŒ–

```bash
uv run black .
uv run isort .
```

### è¿è¡Œæµ‹è¯•

```bash
# åŸºç¡€åŠŸèƒ½æµ‹è¯•
uv run python test/test_docker_sdk.py

# æ€§èƒ½æµ‹è¯•ï¼ˆéœ€è¦DockeræœåŠ¡è¿è¡Œï¼‰
uv run python test/performance_test.py

# ä½¿ç”¨pytestï¼ˆå¦‚æœå®‰è£…äº†ï¼‰
uv run pytest
```

## è®¸å¯è¯

MIT License 